{% extends './index.html' %}
{% block content%}
    <a href="{% url 'board:idea_new' %}"><input type="button" value="Write"></a>
    <ul>
    {% for post in form %}
    <li>
        <a href="{% url 'board:idea_edit' post.pk %}"><h1>{{post.title}}</h1></a>
        <h2>{{post.author}}</h2>
        {%if user in post.likes.all%}
        <input type="button" id="button{{post.pk}}" name="{{post.pk}}" value="Like" style="color:red">
        {%else%}
        <input type="button" id="button{{post.pk}}" name="{{post.pk}}" value="Like" >
        {%endif%}

        <span id="count{{post.pk}}">{{post.total_likes}}</span>
        
    </li>
    {%endfor%}
    </ul>
    <script>
        $('input[type=button]').click(function(){
            var pk=$(this).attr('name')
            $.ajax({
                type:"post",
                url:"{% url 'board:likes_process' %}",
                data: {'pk':pk,'csrfmiddlewaretoken':'{{ csrf_token }}'},
                dataType:"json",
                success:function(response){
                    $('#count'+pk).html(response.message);
                    if(response.flag==true){
                        $('#button'+pk).css('color','red');
                    }
                    else{
                        $('#button'+pk).css('color','black');     
                    }
                },
                error:function(request,status,error){
                    alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }
            });
        })
     </script>
{%endblock %}